# Прогноз температуры стали
## Описание задачи
Чтобы оптимизировать производственные расходы, металлургический комбинат ООО «Так закаляем сталь» решил уменьшить потребление электроэнергии на этапе обработки стали. Необходимо построить модель, которая предскажет температуру стали.
## Описание этапа обработки
Сталь обрабатывают в металлическом ковше вместимостью около 100 тонн. Чтобы ковш выдерживал высокие температуры, изнутри его облицовывают огнеупорным кирпичом. Расплавленную сталь заливают в ковш и подогревают до нужной температуры графитовыми электродами. Они установлены в крышке ковша.

Из сплава выводится сера (десульфурация), добавлением примесей корректируется химический состав и отбираются пробы. Сталь легируют — изменяют её состав — подавая куски сплава из бункера для сыпучих материалов или проволоку через специальный трайб-аппарат (англ. tribe, «масса»).

Перед тем как первый раз ввести легирующие добавки, измеряют температуру стали и производят её химический анализ. Потом температуру на несколько минут повышают, добавляют легирующие материалы и продувают сплав инертным газом. Затем его перемешивают и снова проводят измерения. Такой цикл повторяется до достижения целевого химического состава и оптимальной температуры плавки.

Тогда расплавленная сталь отправляется на доводку металла или поступает в машину непрерывной разливки. Оттуда готовый продукт выходит в виде заготовок-слябов (англ. slab, «плита»).
## Описание данных
Данные состоят из файлов, полученных из разных источников:
* **data_arc_new.csv** — данные об электродах;
* **data_bulk_new.csv** — данные о подаче сыпучих материалов (объём);
* **data_bulk_time_new.csv** — данные о подаче сыпучих материалов (время);
* **data_gas_new.csv** — данные о продувке сплава газом;
* **data_temp_new.csv** — результаты измерения температуры;
* **data_wire_new.csv** — данные о проволочных материалах (объём);
* **data_wire_time_new.csv** — данные о проволочных материалах (время).

Во всех файлах столбец key содержит номер партии. <br>
В файлах может быть несколько строк с одинаковым значением key: они соответствуют разным итерациям обработки.

Целевым признаком является последняя измеренная температура.<br>
Объектом моделирования является ковш (строки с одинаковым значением ***key***)<br>
Целевая метрика: ***MAE***<=6.8
## План работ
1. Исследовательский анализ данных
    * Подключение необходимых библиотек
    * Первичная обработка данных из файлов
    * Вывод
3. Предобработка данных
4. Обучение моделей
5. Итоговый вывод
## Итоговый вывод
1. * Какие пункты плана были выполнены, а какие — нет (поясните почему)?
        - были выполнены все запланированные этапы;
   * Какие трудности возникли и как они были преодолены?
        - основной проблемой на начальных этапах было непонимание объекта моделирования и, соответственно, признаков, на которых будут обучаться модели. В ходе встречи с тимлидом эти вопросы были решены;
   * Какие ключевые шаги в решении задачи выделили?
        - ***Исследовательский анализ и первичная обработка данных***: загрузили данные, избавились от выбросов, заполнили пропуски;
        - ***Предобработка данных***: добавление новых признаков и объединение данных в одну таблицу, разделение данных на тестовую и обучающую, масштабирование признаков;
        - ***Обучение моделей***: выбор регрессионных моделей и их обучение, выбор модели с лучшей метрикой и её проверка на тестовой выборке, анализ важности факторов;
        - ***Отчёт***.
    * Какая ваша итоговая модель и какое у неё качество?
         - Были протестированы 4 модели: 
             * LinearRegression
             * RandomForestRegressor
             * LGBMRegressor
             * CatBoostRegressor<br>
        Лучшее значение метрики **MAE** на обучающей выборке показала модель ***CatBoostRegressor*** равную **6.98**. Эта же самая модель на тестовой выборке показала результат **MAE=6.53**. Самую большой вклад в предсказывание модели вносит признак 'Длительность нагрева'.
            
2. Список признаков, используемых для обучения лучшей модели и описание их предобработки
    - ***Признаки***:  'Длительность нагрева', 'Полная мощность', 'Bulk 1', 'Bulk 10', 'Bulk 11', 'Bulk 12', 'Bulk 13', 'Bulk 14', 'Bulk 15', 'Bulk 2', 'Bulk 3', 'Bulk 4', 'Bulk 5', 'Bulk 6', 'Bulk 7', 'Bulk 8', 'Bulk 9', 'Wire 1', 'Wire 2', 'Wire 3', 'Wire 4', 'Wire 5', 'Wire 6', 'Wire 7', 'Wire 8', 'Wire 9', 'Газ 1', 
    - ***Целевой признак***: 'Температура'
    - ***Предобработка***: были удалены явные аномалии вместе со всей партией в данных про температуру и мощности. Были заполнены нулями пропуски про объемы сыпучих и проволочных материалов. В таблице про электроды были сгенерированы два новых признака 'Длительность нагрева', 'Полная мощность'. Далее из изначальных таблицы были взяты приведенные выше признаки, просуммированы по партиям (колонка *key*). Для целевого признака была взята последняя температура из партии. Далее все данные были объединены в общий датафрейм
3. Гиперпараметры лучшей модели (***CatBoostRegressor***), включая random_state:
    - ***iterations***: 500,    ***learning_rate***: 0.03,    ***loss_function***: 'MAE',     ***random_state***=RandomState(161023)
4. Что рекомендуете для улучшения модели, решения:
    - Наверное стоит в качестве признака использовать также и первую температуру партии, хотя тогда возникает вопрос об управлении ею
    - Дальше накапливать данные, быть может в дальнейшем было бы больше случаев использования присадок, которые в нашей модели имеют практически нулевую важность.
